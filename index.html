
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
    integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="flexhtml.js"></script>
  <link rel="stylesheet" href="flexhtml.css">
  <!-- icon -->
  <link rel="icon" href="https://img.icons8.com/pulsar-color/48/share-3.png" type="image/x-icon">
  <title>Liff Share FLex</title>
  <style>
    body {
      background-color: #fafafa;
      /* background-color: #000; */
    }

    .hide {
      display: none;
    }

    #login-sec {
      min-height: 100vh;
    }

    .linebg {
      background-color: #00B900;
    }

    #flexlist {
      height: 200px;
      /* width: 200px; */
      /* background-color: #000; */
    }

    .loader {
      position: absolute;
      top: 50%;
      left: 50%;
      z-index: 10;
      width: 160px;
      height: 100px;
      margin-left: -80px;
      margin-top: -50px;
      border-radius: 5px;
      background: #1e3f57;
      animation: dot1_ 3s cubic-bezier(0.55, 0.3, 0.24, 0.99) infinite;
    }

    #loader:before {
      content: "Loading";
      position: absolute;
      top: 30%;
      left: 50%;
      z-index: 10;
      translate: -50% -50%;
      font-size: 2rem;
    }

    .loader:nth-child(2) {
      z-index: 11;
      width: 150px;
      height: 90px;
      margin-top: -45px;
      margin-left: -75px;
      border-radius: 3px;
      background: #3c517d;
      animation-name: dot2_;
    }

    .loader:nth-child(3) {
      z-index: 12;
      width: 40px;
      height: 20px;
      margin-top: 50px;
      margin-left: -20px;
      border-radius: 0 0 5px 5px;
      background: #6bb2cd;
      animation-name: dot3_;
    }

    @keyframes dot1_ {

      3%,
      97% {
        width: 160px;
        height: 100px;
        margin-top: -50px;
        margin-left: -80px;
      }

      30%,
      36% {
        width: 80px;
        height: 120px;
        margin-top: -60px;
        margin-left: -40px;
      }

      63%,
      69% {
        width: 40px;
        height: 80px;
        margin-top: -40px;
        margin-left: -20px;
      }
    }

    @keyframes dot2_ {

      3%,
      97% {
        height: 90px;
        width: 150px;
        margin-left: -75px;
        margin-top: -45px;
      }

      30%,
      36% {
        width: 70px;
        height: 96px;
        margin-left: -35px;
        margin-top: -48px;
      }

      63%,
      69% {
        width: 32px;
        height: 60px;
        margin-left: -16px;
        margin-top: -30px;
      }
    }

    @keyframes dot3_ {

      3%,
      97% {
        height: 20px;
        width: 40px;
        margin-left: -20px;
        margin-top: 50px;
      }

      30%,
      36% {
        width: 8px;
        height: 8px;
        margin-left: -5px;
        margin-top: 49px;
        border-radius: 8px;
      }

      63%,
      69% {
        width: 16px;
        height: 4px;
        margin-left: -8px;
        margin-top: -37px;
        border-radius: 10px;
      }
    }
  </style>
</head>

<body>
  <section id="loader">
    <div class="container">
      <div class="loader"></div>
      <div class="loader"></div>
      <div class="loader"></div>
    </div>
  </section>

  <section id="login-sec" class="d-flex justify-content-center align-items-center">
    <div class="border rounded-3 shadow p-4" style="display: none;" <p class="text-dark fw-bold">กรุณา Login
      ด้วยไลน์ เพื่อส่งข้อความไปยังผู้รับ</p>
      <div class="col-12 text-center mt-2">
        <button class="btn btn-lg linebg text-light" id="login-btn"><img
            src="https://img.icons8.com/fluency-systems-regular/48/ffffff/line-me.png" />Login</button>
      </div>
    </div>
  </section>
  <section id="input-sec" style="display: none;">
    <div class="container">
      <div class="display-4 mt-4">สวัสดี&nbsp;<span id="displayName"></span> <img id="display-img"
          class="rounded-circle" style="width: 50px;"></div>
      <div class="row justify-content-start mt-3">
        <div class="col-md-4">
          <label for="altText">ข้อความแสดงแทน FLEX หน้าแชท <span class="text-muted"
              id="text-count">(0/400)</span></label>
          <input type="text" class="form-control" id="altText" maxlength="400">
        </div>
      </div>
      <div class=" justify-content-center gap-2 d-flex flex-column-reverse flex-md-row mt-3 mt-md-3">
        <div class="col-md-7 mt-3">
          <label for="json">JSON</label>
          <textarea name="json" id="json" rows="15" class="form-control"></textarea>
          <div class="row g-3 mt-1">
            <div class="col">
              <button id="save" class="btn btn-primary w-100"><i class="bi bi-floppy2-fill"></i>&nbsp;บันทึก</button>
            </div>
            <!-- <div class="col">
                            <button id="send" class="btn btn-warning hide">ส่งในห้องแชทนี้</button>
                        </div> -->
            <!-- <div class="col">
                            <button id="preview" class="btn btn-warning w-100"><i
                                    class="bi bi-eye-fill"></i>&nbsp;ดูตัวอย่าง</button>
                        </div> -->
            <div class="col">
              <button id="shared" class="btn btn-success w-100"><i
                  class="bi bi-share-fill"></i>&nbsp;แชร์ไปห้องแชทอื่น</button>
            </div>
          </div>
        </div>
        <div class="col-md-5 rounded"
          style="background-color: #849ebf;background-image: url(./line\ bg.jpg);background-size: contain;overflow: auto;">
          <div class="reset-this">
            <div id="flex-show" style="padding-top: 10px;">
              <div class="text-light w-100 text-center my-3">
                พื้นที่แสดงตัวอย่าง Flex จะปรากฏที่นี่
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>
  <div class="modal fade" id="previewModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header d-flex justify-content-between">
          <h5 class="modal-title " id="previewModalLabel">Flex Preview</h5>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
        </div>
        <div class="modal-body"
          style="background-color: #849ebf;background-image: url(./line\ bg.jpg);background-size: contain;">
          <div class="reset-this container-fluid">
            <div id="flex1"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-info" id="json-copy">Copy</button>
          <button type="button" class="btn btn-warning" id="json-update">Update <span class="hide"
              id="update-id"></span></button>
        </div>
      </div>
    </div>
  </div>
  <section>
    <div class="container mb-5">
      <div class="col-md-4 listtemplate mt-2 hide">
        <div class="btn-group d-flex">
          <button type="button" class="btn btn-outline-info text-dark fw-bold btn-head col-12"></button>
          <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown"
            aria-expanded="false">
            <span class="visually-hidden">Toggle Dropdown</span>
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            <!-- <li class="m-1"><a class="btn btn-warning send-flex w-100">ส่งในห้องแชทนี้</a></li> -->
            <li class="m-1"><a class="btn btn-success shared-flex w-100">แชร์ไปห้องแชทอื่น</a></li>
            <li class="m-1"><a class="btn btn-secondary show-json w-100">ดู JSON</a></li>
            <li class="m-1"><a class="btn btn-warning share-link w-100">คัดลอกลิ้งค์แชร์</a></li>
            <li class="m-1"><a class="btn btn-danger delete-list w-100">ลบ</a></li>
          </ul>
        </div>
      </div>
      <div id="flexlist" class="row justify-content-start mt-3">

      </div>
    </div>
  </section>
  <!-- <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>

    <script>

        // VConsole will be exported to `window.VConsole` by default.

        // var vConsole = new window.VConsole();

    </script> -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    var Toast
    $(document).ready(() => {
      // $.LoadingOverlay("show");
      Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 1500,
        timerProgressBar: true,
      })
      main()
      // flex2html('testflex', JSON.parse(testflex))
    })
    function copy(id = 'json-code') {
      let $temp = $('<input>')
      $('body').append($temp)
      let element = document.getElementById(id)
      element.select()
      element.setSelectionRange(0, 99999)
      navigator.clipboard.writeText(element.value).then(() => {
        $temp.remove()
        Toast.fire({
          icon: 'success',
          title: 'คัดลอกเรียบร้อย'
        })
      }, () => {
        $temp.remove()
        Toast.fire({
          icon: 'error',
          title: 'คัดลอกล้มเหลว'
        })
      })

    }
  </script>
  <script>
    const EXPIRE_USERS = [
      'U026ec80e42049561bd41cf92d4c55955',
      'U5fb67c286549e2eec9ff7f67e9c15690',
      'Ud2256fed03eacac0ed0d5d679ebdacde',
      'U0f88770ee60bc3b9ec52f9a95179d191',
      'Ue86787127a9bb5465c58d3932ed06bbb'
    ]
    var profile, flexlist, flexid = undefined
    var scripturl = 'https://script.google.com/macros/s/AKfycbzDrVrPPTbKHKTySkUHxwc2DclT8-tZvzRi8abRYyhDgT98YQTlpE9DsZ3jtNeg1xIO/exec'
    var starttime = new Date().getTime()
    async function main() {
      liff.init({
        liffId: '2005615503-drRxpq86', withLoginOnExternalBrowser: true
      });

      liff.ready.then(async () => {
        // if loader show less than 3 sec then wait 3 sec
        let endtime = new Date().getTime()
        let waittime = 3000 - (endtime - starttime)
        if (waittime > 0) {
          await new Promise(resolve => setTimeout(resolve, waittime))
        }

        console.log('liff ready')
        if (liff.isLoggedIn()) {
          if (EXPIRE_USERS.includes(liff.getDecodedIDToken().sub)) {
            $('section').remove()
            $('.modal').remove()
            Swal.fire({
              icon: 'error',
              title: 'การทดลองใช้งานหมดอายุ',
              html: 'กรุณาติดต่อผู้พัฒนาเพื่อใช้งานเวอร์ชั่นเต็ม<br>Line ID: <a href="https://line.me/ti/p/FrAUVjmBeJ" target="_blank">wmhakrook</a><br>หรือ โทร <a href="tel:0904017402">090-401-7402</a><br>ขอบคุณครับ',
              allowOutsideClick: false,
              showConfirmButton: true,
              confirmButtonText: 'ปิดหน้านี้',
            }).then(() => {
              liff.closeWindow()
            })
          }
          var parameter = new URLSearchParams(window.location.search)
          flexid = parameter.get('s')
          if (flexid) {
            $.post(scripturl, {
              q: 'getflex',
              id: parameter.get('s')
            }).done(function (result) {
              
              if (result.flex) {
                $('#loader').hide()
                $('#json').val(JSON.stringify(JSON.parse(result.flex), undefined, 4))
                $('#altText').val(result.altText)
                $('#shared').click()
              } else {
                $('section').remove()
                $('.modal').remove()
                $('#loader').hide()
                Swal.fire({
                  icon: 'error',
                  title: 'เกิดข้อผิดพลาด',
                  text: 'ไม่พบข้อมูล Flex ที่คุณต้องการ',
                  allowOutsideClick: false,
                  showConfirmButton: true,
                  confirmButtonText: 'ปิดหน้านี้',
                }).then(() => {
                  liff.closeWindow()
                })
              }
            })
          } else {
            flexid = undefined
            $('#loader').hide()
            $('#login-sec').removeClass('d-flex').hide();
            $('#input-sec').slideDown(200);
            let context = await liff.getContext()
            if (context.type == 'square_chat') {
              profile = { displayName: 'openchat', userId: context.squareMemberId, isSquare: true }
            } else profile = await liff.getProfile();
            $('#displayName').html(profile.displayName);
            $('#display-img').attr('src', profile.pictureUrl);
            if (liff.isInClient() || liff.getContext().type === 'square_chat') {
              $('#send').slideDown(200);
            }
            getFlex()
          }
        }
        else {
          $('#loader').hide()
          $('#login-sec div').slideDown(200);
          $('#login-btn').click(function () {
            liff.login({ redirectUri: window.location.href });
          })
        }
      })


    }
    // getFlex()
  </script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    var Toast;
    $(document).ready(() => {
      // $.LoadingOverlay("show");
      Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 1500,
        timerProgressBar: true,
      });
      main();
      // flex2html('testflex', JSON.parse(testflex))
    });
  
    function copy(id = 'json-code') {
      let $temp = $('<input>');
      $('body').append($temp);
      let element = document.getElementById(id);
      element.select();
      element.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(element.value).then(() => {
        $temp.remove();
        Toast.fire({
          icon: 'success',
          title: 'คัดลอกเรียบร้อย'
        });
      }, () => {
        $temp.remove();
        Toast.fire({
          icon: 'error',
          title: 'คัดลอกล้มเหลว'
        });
      });
    }
  </script>
  
  <script>
    const EXPIRE_USERS = [
      'U026ec80e42049561bd41cf92d4c55955',
      'U5fb67c286549e2eec9ff7f67e9c15690',
      'Ud2256fed03eacac0ed0d5d679ebdacde',
      'U0f88770ee60bc3b9ec52f9a95179d191',
      'Ue86787127a9bb5465c58d3932ed06bbb'
    ];
    var profile, flexlist, flexid = undefined;
    var scripturl = 'https://script.google.com/macros/s/AKfycbzDrVrPPTbKHKTySkUHxwc2DclT8-tZvzRi8abRYyhDgT98YQTlpE9DsZ3jtNeg1xIO/exec';
    var starttime = new Date().getTime();
    async function main() {
      liff.init({
        liffId: '2005615503-drRxpq86', withLoginOnExternalBrowser: true
      });
  
      liff.ready.then(async () => {
        // if loader show less than 3 sec then wait 3 sec
        let endtime = new Date().getTime();
        let waittime = 3000 - (endtime - starttime);
        if (waittime > 0) {
          await new Promise(resolve => setTimeout(resolve, waittime));
        }
  
        console.log('liff ready');
        if (liff.isLoggedIn()) {
          if (EXPIRE_USERS.includes(liff.getDecodedIDToken().sub)) {
            $('section').remove();
            $('.modal').remove();
            Swal.fire({
              icon: 'error',
              title: 'การทดลองใช้งานหมดอายุ',
              html: 'กรุณาติดต่อผู้พัฒนาเพื่อใช้งานเวอร์ชั่นเต็ม<br>Line ID: <a href="https://line.me/ti/p/FrAUVjmBeJ" target="_blank">wmhakrook</a><br>หรือ โทร <a href="tel:0904017402">090-401-7402</a><br>ขอบคุณครับ',
              allowOutsideClick: false,
              showConfirmButton: true,
              confirmButtonText: 'ปิดหน้านี้',
            }).then(() => {
              liff.closeWindow();
            });
          }
          var parameter = new URLSearchParams(window.location.search);
          flexid = parameter.get('s');
          if (flexid) {
            $.post(scripturl, {
              q: 'getflex',
              id: parameter.get('s')
            }).done(function (result) {
  
              if (result.flex) {
                $('#loader').hide();
                $('#json').val(JSON.stringify(JSON.parse(result.flex), undefined, 4));
                $('#altText').val(result.altText);
                $('#shared').click();
              } else {
                $('section').remove();
                $('.modal').remove();
                $('#loader').hide();
                Swal.fire({
                  icon: 'error',
                  title: 'เกิดข้อผิดพลาด',
                  text: 'ไม่พบข้อมูล Flex ที่คุณต้องการ',
                  allowOutsideClick: false,
                  showConfirmButton: true,
                  confirmButtonText: 'ปิดหน้านี้',
                }).then(() => {
                  liff.closeWindow();
                });
              }
            });
          } else {
            flexid = undefined;
            $('#loader').hide();
            $('#login-sec').removeClass('d-flex').hide();
            $('#input-sec').slideDown(200);
            let context = await liff.getContext();
            if (context.type == 'square_chat') {
              profile = { displayName: 'openchat', userId: context.squareMemberId, isSquare: true };
            } else profile = await liff.getProfile();
            $('#displayName').html(profile.displayName);
            $('#display-img').attr('src', profile.pictureUrl);
            if (liff.isInClient() || liff.getContext().type === 'square_chat') {
              $('#send').slideDown(200);
            }
            getFlex();
          }
        }
        else {
          $('#loader').hide();
          $('#login-sec div').slideDown(200);
          $('#login-btn').click(function () {
            liff.login({ redirectUri: window.location.href });
          });
        }
      });
    }
    // getFlex()
  </script>
  
  <script>
    $('#altText').on('input', function () {
      let text = $(this).val();
      $('#text-count').text(`(${text.length}/400)`);
    });
  
    $('#json').on('input', function () {
      if ($(this).val() == '') {
        $('#flex-show').html('<div class="text-light w-100 text-center my-3">พื้นที่แสดงตัวอย่าง Flex จะปรากฏที่นี่</div>');
        return false;
      }
      let json = getJSON(true);
      if (json) {
        $('#flex-show').html('');
        flex2html('flex-show', json);
      } else {
        $('#flex-show').html(`<div style="color: white; font-size: 1rem; text-align: center; padding-top: 20px">Invalid JSON</div>`);
      }
    });
  
    $('#preview').click(function () {
      let flex = getJSON();
      if (flex) {
        $('#flex1').html('');
        flex2html("flex1", flex);
        $('.modal').modal('show');
      }
    });
  
    $('#shared').click(function () {
      var flex = getJSON();
      if (flex) {
        if (JSON.stringify(flex).indexOf('{{share}}') > -1 && !flexid) {
          Swal.fire({
            icon: 'error',
            title: 'หากกำหนดให้มีคีย์เวิร์ด share คุณจำเป็นที่จะต้องบันทึก Flex นี้ก่อนการแชร์',
          });
          return false;
        }
        sendShare(flex);
      }
    });
  
    $('#send').click(function () {
      var flex = getJSON();
      if (flex) {
        if (JSON.stringify(flex).indexOf('{{share}}') > -1 && !flexid) {
          Swal.fire({
            icon: 'error',
            title: 'หากกำหนดให้มีคีย์เวิร์ด share คุณจำเป็นที่จะต้องบันทึก Flex นี้ก่อนการแชร์',
          });
          return false;
        }
        sendInChat(flex);
      }
    });
  
    $('#save').click(function () {
      let flex = getJSON();
      if (flex) {
        Swal.fire({
          title: 'กรุณาใส่ชื่อ FLEX',
          input: 'text',
          inputAttributes: {
            autocapitalize: 'off'
          },
          showCancelButton: true,
          confirmButtonText: 'Save',
          showLoaderOnConfirm: true,
          preConfirm: (templateName) => {
            return $.ajax({
              url: scripturl,
              method: 'POST',
              data: {
                q: 'put',
                isSquare: profile.isSquare ? 'true' : 'false',
                name: templateName,
                flex: JSON.stringify(flex),
                uid: profile.userId,
                liff_id: liff.id
              }
            });
          },
          allowOutsideClick: () => !Swal.isLoading()
        }).then((result) => {
          if (result.isConfirmed) {
            const output = result.value;
            if (output.result === 'duplicate') {
              Swal.fire({
                icon: 'warning',
                title: 'Oops...',
                text: 'ชื่อซ้ำ',
                showConfirmButton: false,
                timer: 1500
              });
            } else if (output.result === 'success') {
              const item = output.data;
              let row = $('.listtemplate').clone();
              $(row).removeClass('hide listtemplate');
              $(row).attr('id', item[0]);
              $(row).find('.btn-head').text(item[1]);
              $(row).find('.show-preview').append(`<p style="display: none">${item[2]}</p>`);
              $(row).find('.delete-list').attr('id', item[0]);
              $(row).find('.show-json').append(`<p style="display: none">${item[2]}</p>`);
              $(row).find('.share-link').append(`<input type="text" style="opacity: 0" value="${window.location.href.split('?')[0] + '?s=' + item[0]}">`);
              $('#flex-list').append(row);
              $('#flex-list div').slideDown(200);
              flexid = item[0];
              Swal.fire({
                icon: 'success',
                title: 'บันทึกสำเร็จ',
                showConfirmButton: false,
                timer: 1500
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Oops...',
                text: 'บันทึกล้มเหลว',
                showConfirmButton: false,
                timer: 1500
              });
            }
          }
        });
      }
    });
  
    async function getFlex() {
      $.post(scripturl, {
        q: 'getflexlist',
        uid: profile.userId
      }).done(function (result) {
        console.log(result);
        flexlist = result.list;
        if (result.list.length == 0) {
          $('#flex-list').html(`<div style="color: white; font-size: 1rem; text-align: center; padding-top: 20px">ยังไม่มีการบันทึก Flex</div>`);
          return false;
        }
        for (let i = 0; i < result.list.length; i++) {
          let row = $('.listtemplate').clone();
          $(row).removeClass('hide listtemplate');
          $(row).attr('id', result.list[i][0]);
          $(row).find('.btn-head').text(result.list[i][1]);
          $(row).find('.show-preview').append(`<p style="display: none">${result.list[i][2]}</p>`);
          $(row).find('.delete-list').attr('id', result.list[i][0]);
          $(row).find('.show-json').append(`<p style="display: none">${result.list[i][2]}</p>`);
          $(row).find('.share-link').append(`<input type="text" style="opacity: 0" value="${window.location.href.split('?')[0] + '?s=' + result.list[i][0]}">`);
          $('#flex-list').append(row);
          $('#flex-list div').slideDown(200);
        }
      });
    }
  
    function getJSON(checkonly = false) {
      try {
        let flex = JSON.parse($('#json').val());
        if (flex.type != 'bubble' && flex.type != 'carousel') throw '';
        if (!checkonly) return flex;
      } catch (error) {
        Toast.fire({
          icon: 'error',
          title: 'กรุณาใส่ JSON ที่ถูกต้อง'
        });
        return false;
      }
    }
  
    function flex2html(id, flex) {
      liff.FlexMessage.create({ container: id, content: flex });
    }
  
    function sendInChat(flex) {
      var altText = $('#altText').val();
      liff.sendMessages([{
        type: 'flex',
        altText: altText,
        contents: flex,
      }]).then(function () {
        Toast.fire({
          icon: 'success',
          title: 'ส่งเรียบร้อย'
        });
      }).catch(function (error) {
        console.log('error:', error);
        Toast.fire({
          icon: 'error',
          title: 'ส่งล้มเหลว'
        });
      });
    }
  
    function sendShare(flex) {
      var altText = $('#altText').val();
      liff.shareTargetPicker([{
        type: 'flex',
        altText: altText,
        contents: flex,
      }]).then(function () {
        Toast.fire({
          icon: 'success',
          title: 'ส่งเรียบร้อย'
        });
      }).catch(function (error) {
        console.log('error:', error);
        Toast.fire({
          icon: 'error',
          title: 'ส่งล้มเหลว'
        });
      });
    }
  
    $(document).on('click', '.delete-list', function () {
      let id = $(this).attr('id');
      Swal.fire({
        title: 'คุณต้องการที่จะลบ Flex นี้ใช่หรือไม่?',
        showCancelButton: true,
        confirmButtonText: 'ลบ',
        cancelButtonText: 'ยกเลิก',
      }).then((result) => {
        if (result.isConfirmed) {
          $.post(scripturl, {
            q: 'delete',
            id: id,
            uid: profile.userId
          }).done(function (result) {
            if (result.result === 'success') {
              $(`#${id}`).remove();
              Swal.fire({
                icon: 'success',
                title: 'ลบสำเร็จ',
                showConfirmButton: false,
                timer: 1500
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'ลบล้มเหลว',
                showConfirmButton: false,
                timer: 1500
              });
            }
          });
        }
      });
    });
  
    $(document).on('click', '.share-link', function () {
      $(this).find('input').select();
      document.execCommand("copy");
      Toast.fire({
        icon: 'success',
        title: 'คัดลอกลิ้งค์แล้ว'
      });
    });
  
    $(document).on('click', '.show-json', function () {
      let flex = JSON.parse($(this).find('p').text());
      $('#flex1').html('');
      flex2html("flex1", flex);
      $('.modal').modal('show');
    });
  
    $(document).on('click', '.show-preview', function () {
      let flex = JSON.parse($(this).find('p').text());
      $('#flex1').html('');
      flex2html("flex1", flex);
      $('.modal').modal('show');
    });
  
    $('#add-list').click(function () {
      Swal.fire({
        title: 'กรุณาใส่ชื่อ FLEX',
        input: 'text',
        inputAttributes: {
          autocapitalize: 'off'
        },
        showCancelButton: true,
        confirmButtonText: 'Save',
        showLoaderOnConfirm: true,
        preConfirm: (templateName) => {
          return $.ajax({
            url: scripturl,
            method: 'POST',
            data: {
              q: 'put',
              isSquare: profile.isSquare ? 'true' : 'false',
              name: templateName,
              flex: JSON.stringify({}),
              uid: profile.userId,
              liff_id: liff.id
            }
          });
        },
        allowOutsideClick: () => !Swal.isLoading()
      }).then((result) => {
        if (result.isConfirmed) {
          const output = result.value;
          if (output.result === 'duplicate') {
            Swal.fire({
              icon: 'warning',
              title: 'Oops...',
              text: 'ชื่อซ้ำ',
              showConfirmButton: false,
              timer: 1500
            });
          } else if (output.result === 'success') {
            const item = output.data;
            let row = $('.listtemplate').clone();
            $(row).removeClass('hide listtemplate');
            $(row).attr('id', item[0]);
            $(row).find('.btn-head').text(item[1]);
            $(row).find('.show-preview').append(`<p style="display: none">${item[2]}</p>`);
            $(row).find('.delete-list').attr('id', item[0]);
            $(row).find('.show-json').append(`<p style="display: none">${item[2]}</p>`);
            $(row).find('.share-link').append(`<input type="text" style="opacity: 0" value="${window.location.href.split('?')[0] + '?s=' + item[0]}">`);
            $('#flex-list').append(row);
            $('#flex-list div').slideDown(200);
            flexid = item[0];
            Swal.fire({
              icon: 'success',
              title: 'บันทึกสำเร็จ',
              showConfirmButton: false,
              timer: 1500
            });
          } else {
            Swal.fire({
              icon: 'error',
              title: 'Oops...',
              text: 'บันทึกล้มเหลว',
              showConfirmButton: false,
              timer: 1500
            });
          }
        }
      });
    });
  
  </script> 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>

